var TitleAnimationView=Backbone.View.extend({width:350,height:224,interval:1e3,initialize:function(){_.bindAll(this,"render")},render:function(){var e=(this.height,this.width,this.interval,[]),n=[{x:116,y:124},{x:150,y:126},{x:161,y:140},{x:183,y:147},{x:203,y:148},{x:225,y:151}],t=d3.select(this.el).select("svg"),a=0,r=t.selectAll("circle"),i=["oil","gas","coal"];setInterval(function(){var t=Math.floor(Math.random()*n.length),o={id:t,x:n[t].x,y:n[t].y,idx:a};e.push(o),e.length>300&&e.shift(),r=r.data(e,function(e){return e.idx}),r.exit().remove(),r.enter().append("circle").attr({"class":function(e){return"particle "+i[e.id]},transform:function(e){var n=e.x,t=e.y;return"translate("+[n,t].join(" ")+")"},cx:0,cy:0,r:2}).style({fill:"#cc545b"}).transition().ease("cubic-out").duration(10500).attr({transform:function(){var e=n[t].x+50*(Math.random()-.5),a=0;return"translate("+[e,a].join(" ")+")"},r:10}).style({fill:"#333"}),a++},10)}}),LowHangingFruitView=Backbone.View.extend({width:750,height:300,interval:1e3,events:{"click .stage-next":"next"},initialize:function(){_.bindAll(this,"render","next")},next:function(){return this.$el.addClass("stage2"),!1},render:function(){var e=this.height,n=this.width,t=(this.interval,[]),a=d3.scale.linear().domain([0,14.01,22.01,100]).range([0,1,2,3]),r=[d3.scale.linear().domain([0,1]).range([0,98]),d3.scale.linear().domain([0,1]).range([125,181]),d3.scale.linear().domain([0,1]).range([204,750])],i=[d3.scale.linear().domain([0,1]).range([0,546]),d3.scale.linear().domain([0,1]).range([572,632]),d3.scale.linear().domain([0,1]).range([650,750])],o=d3.scale.linear().domain([0,1]).range([0,40]),l=d3.select(this.el).select("svg").attr({width:n,height:e}),c=0,s=l.selectAll("circle"),d=["oil","gas","coal"];setInterval(function(){var n=(new Date,Math.floor(a(100*Math.random()))),l={id:n,x:i[n](Math.random()),y:e,idx:c};t.push(l),t.length>1e3&&t.shift(),s=s.data(t,function(e){return e.idx}),s.exit().remove(),s.enter().append("circle").attr({"class":function(e){return"particle "+d[e.id]},transform:function(n){var t=n.x,a=e;return"translate("+[t,a].join(" ")+")"},cx:0,cy:0,r:20}).transition().ease("cubic-out").duration(5500).attr({transform:function(e){var n=r[e.id](Math.random()),t=o(Math.random());return"translate("+[n,t].join(" ")+")"},r:4}),c++},10)}}),PolicyScenario=Backbone.View.extend({initialize:function(e){_.bindAll(this,"render"),this.data=e.data},render:function(){var e=this.data,n=this.model.get("index")||0,t=e[n],a=[t.value_loss,t.higher_costs,t.tax_revenue,t.net_gain],r=d3.format(".1f"),i=d3.select(this.el),o=i.select(".svg-detail svg");i.select("#country-name").text(t.region);var l=o.selectAll(".bar").data(a),c=d3.scale.linear().domain([0,d3.max(a,function(e){return Math.abs(e)})]).range([0,71]),s=l.enter().append("g").attr({"class":"bar",transform:function(e,n){var t=0,a=80*n+10;return"translate("+[t,a].join(" ")+")"}});s.append("rect").attr({height:30}),s.append("text").attr({"class":"num-label","text-anchor":"middle",transform:function(){var e=100,n=20;return"translate("+[e,n].join(" ")+")"}}),l.selectAll("rect").transition().attr({transform:function(e){var n=e>=0?129:71+c(e),t=0;return"translate("+[n,t].join(" ")+")"},width:function(e){return Math.abs(c(e))}}),l.select(".num-label").text(function(e){return e>0?"+"+r(e/1e3):r(e/1e3)})}}),PolicyScenarioCountries=PolicyScenario.extend({events:{"click #net-country-1":"changeCountry","click #net-country-2":"changeCountry","click #net-country-3":"changeCountry","click #net-country-4":"changeCountry","click #net-country-5":"changeCountry","click #net-country-6":"changeCountry"},initialize:function(e){_.bindAll(this,"render","changeCountry"),this.data=e.data,this.model.on("change:index",this.render)},changeCountry:function(e){var n=parseInt($(e.currentTarget).attr("id").split("-")[2]);this.model.set("index",n-1)}}),Model=Backbone.Model.extend({});$(document).ready(function(){var e=new LowHangingFruitView({el:"#low-hanging-fruit"});e.render();var n=new TitleAnimationView({el:"#intro"});n.render(),d3.json("data/scenarios.json",function(e){var n=e.taxes,t=e.innovation,a=e.countries,r=new PolicyScenario({model:new Model,data:n,el:"#scenario-taxes-cost"});r.render();var i=new PolicyScenario({model:new Model,data:t,el:"#scenario-innovation"});i.render();var o=new PolicyScenarioCountries({model:new Model({index:0}),data:a,el:"#scenario-taxes-consumer-benefit"});o.render()})});