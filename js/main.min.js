var TitleAnimationView=Backbone.View.extend({width:350,height:224,interval:1e3,initialize:function(){_.bindAll(this,"render")},render:function(){var e=(this.height,this.width,this.interval,[]),n=[{x:116,y:124},{x:150,y:126},{x:161,y:140},{x:183,y:147},{x:203,y:148},{x:225,y:151}],t=d3.select(this.el).select("svg"),a=0,i=t.selectAll("circle"),r=["oil","gas","coal"];setInterval(function(){var t=Math.floor(Math.random()*n.length),o={id:t,x:n[t].x,y:n[t].y,idx:a};e.push(o),e.length>300&&e.shift(),i=i.data(e,function(e){return e.idx}),i.exit().remove(),i.enter().append("circle").attr({"class":function(e){return"particle "+r[e.id]},transform:function(e){var n=e.x,t=e.y;return"translate("+[n,t].join(" ")+")"},cx:0,cy:0,r:2}).style({fill:"#cc545b"}).transition().ease("cubic-out").duration(10500).attr({transform:function(){var e=n[t].x+50*(Math.random()-.5),a=0;return"translate("+[e,a].join(" ")+")"},r:10}).style({fill:"#333"}),a++},10)}}),LowHangingFruitView=Backbone.View.extend({width:750,height:300,interval:5,numBubbles:750,events:{"click .stage-next":"next"},initialize:function(){_.bindAll(this,"render","next")},next:function(){return this.$el.addClass("stage2"),!1},render:function(){var e=this.height,n=this.width,t=this.interval,a=[],i=d3.scale.linear().domain([0,14.01,22.01,100]).range([0,1,2,3]),r=2,o=8,l=[d3.scale.linear().domain([0,1]).range([o,98-o]),d3.scale.linear().domain([0,1]).range([125+o,181-o]),d3.scale.linear().domain([0,1]).range([204+o,750-o])],c=[d3.scale.linear().domain([0,1]).range([0,546]),d3.scale.linear().domain([0,1]).range([572,632]),d3.scale.linear().domain([0,1]).range([650,750])],s=d3.scale.linear().domain([0,1]).range([0,40]),d=d3.select(this.el).select("svg").attr({width:n,height:e}),u=0,h=d.selectAll("circle"),g=["oil","gas","coal"],f=this.numBubbles,t=this.interval;setInterval(function(){var n=(new Date,Math.floor(i(100*Math.random()))),t={id:n,x:c[n](Math.random()),y:e,idx:u};a.push(t),a.length>f&&a.shift(),h=h.data(a,function(e){return e.idx}),h.exit().remove(),h.enter().append("circle").attr({"class":function(e){return"particle "+g[e.id]},transform:function(n){var t=n.x,a=e;return"translate("+[t,a].join(" ")+")"},cx:0,cy:0,r:r}).transition().ease("cubic-out").duration(2e4).attr({transform:function(e){var n=l[e.id](Math.random()),t=s(Math.random());return"translate("+[n,t].join(" ")+")"},r:o}),u++},t)}}),PolicyScenario=Backbone.View.extend({initialize:function(e){_.bindAll(this,"render"),this.data=e.data},render:function(){var e=this.data,n=this.model.get("index")||0,t=e[n],a=[t.value_loss,t.higher_costs,t.tax_revenue,t.net_gain],i=d3.format(".1f"),r=d3.select(this.el),o=r.select(".svg-detail svg");r.select("#country-name").text(t.region);var l=o.selectAll(".bar").data(a),c=d3.scale.linear().domain([0,d3.max(a,function(e){return Math.abs(e)})]).range([0,71]),s=l.enter().append("g").attr({"class":"bar",transform:function(e,n){var t=0,a=80*n+10;return"translate("+[t,a].join(" ")+")"}});s.append("rect").attr({height:30}),s.append("text").attr({"class":"num-label","text-anchor":"middle",transform:function(){var e=100,n=20;return"translate("+[e,n].join(" ")+")"}}),l.selectAll("rect").transition().attr({transform:function(e){var n=e>=0?129:71+c(e),t=0;return"translate("+[n,t].join(" ")+")"},width:function(e){return Math.abs(c(e))}}),l.select(".num-label").text(function(e){return e>0?"+"+i(e/1e3):i(e/1e3)})}}),PolicyScenarioCountries=PolicyScenario.extend({events:{"click #net-country-1":"changeCountry","click #net-country-2":"changeCountry","click #net-country-3":"changeCountry","click #net-country-4":"changeCountry","click #net-country-5":"changeCountry","click #net-country-6":"changeCountry"},initialize:function(e){_.bindAll(this,"render","changeCountry"),this.data=e.data,this.model.on("change:index",this.render)},changeCountry:function(e){var n=parseInt($(e.currentTarget).attr("id").split("-")[2]);this.model.set("index",n-1)}}),Model=Backbone.Model.extend({});$(document).ready(function(){var e=new LowHangingFruitView({el:"#low-hanging-fruit"});e.render();var n=new TitleAnimationView({el:"#intro"});n.render(),d3.json("data/scenarios.json",function(e){var n=e.taxes,t=e.innovation,a=e.countries,i=new PolicyScenario({model:new Model,data:n,el:"#scenario-taxes-cost"});i.render();var r=new PolicyScenario({model:new Model,data:t,el:"#scenario-innovation"});r.render();var o=new PolicyScenarioCountries({model:new Model({index:0}),data:a,el:"#scenario-taxes-consumer-benefit"});o.render()})});